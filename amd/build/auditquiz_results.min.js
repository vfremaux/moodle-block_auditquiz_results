define(["jquery","core/log","core/config","block_auditquiz_results/html2canvas"],function(a,b,c,d){var e={init:function(){a(".auditquiz-results-unbind").bind("click",this.unbind_course),a(".auditquiz-snapshot-btn").bind("click",this.send_image),a(".auditquiz-snapshots").on("click",".auditquiz-snapshot-delete-btn","",this.delete_image),a(".user-sort").bind("click",[],this.change_user_sorting),b.debug("AMD Auditquiz results initialized")},unbind_course:function(b){b.preventDefault();var d=a(this),e=d.attr("id").split("-"),f=e[1],g=e[2],h=e[3],i=c.wwwroot+"/blocks/auditquiz_results/ajax/service.php";i+="?what=unbind",i+="&blockid="+f,i+="&qcatid="+g,i+="&courseid="+h,a.get(i,function(){a("#id-coursebinding-"+g+"-"+h).css("display","none")},"html")},send_image:function(){var e=a(this),f=e.attr("id"),g=e.attr("data-blockid"),h=e.attr("data-itemid"),i=e.attr("data-type"),j=f.replace("snapshot-","");d(document.querySelector("#"+j)).then(function(d){var e=c.wwwroot+"/blocks/auditquiz_results/ajax/service.php";b.debug("url set "),canvascontent=d.toDataURL(),data={what:"addsnapshot",blockid:g,itemid:h,snaptype:i,imagedata:canvascontent},a.post(e,data,function(b){a("#id-auditquiz-snapshots-container-"+h+"-"+g).html(b),a("#id-auditquiz-snapshots-container-"+h+"-"+g).css("display","block")},"html")})},delete_image:function(){var b=a(this),d=b.attr("data-fileid"),e=b.attr("data-itemid"),f=b.attr("data-type"),g=b.attr("data-blockid"),h=c.wwwroot+"/blocks/auditquiz_results/ajax/service.php";data={what:"deletesnapshot",snapshotid:d,blockid:g,itemid:e,snaptype:f},a.post(h,data,function(b){a("#id-auditquiz-snapshots-container-"+e+"-"+g).html(b)},"html")},change_user_sorting:function(){var b=a(this),d=b.attr("data-sort"),e=b.attr("data-blockid"),f=b.attr("data-courseid"),g=b.attr("data-view"),h=c.wwwroot+"/blocks/auditquiz_results/coursereport.php";h+="?view="+g,h+="&blockid="+e,h+="&id="+f,h+="&sort="+d,window.location.href=h}};return e});